<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <title>Verify Your Email Contact List | Email Validator - Fast & Accurate Email Verification</title>
    <meta name="title" content="Verify Your Email Contact List | Email Validator - Fast & Accurate Email Verification">
    <meta name="description" content="Verify email addresses in your contact list instantly. Our email validator checks individual email addresses to ensure they are legitimate and deliverable. Free CSV upload.">
    <meta name="keywords" content="email validator, email verification, verify email addresses, email list verification, bulk email validator, CSV email verification, email validation tool, check email validity, email address checker, contact list verification">
    <meta name="author" content="PATTENS">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://email-validator.pattens.tech">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://email-validator.pattens.tech">
    <meta property="og:title" content="Verify Your Email Contact List | Email Validator">
    <meta property="og:description" content="Verify email addresses in your contact list instantly. Our email validator checks individual email addresses to ensure they are legitimate and deliverable.">
    <meta property="og:image" content="https://email-validator.pattens.tech/assets/og-image.jpg">
    <meta property="og:site_name" content="Email Validator">
    <meta property="og:locale" content="en_US">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://email-validator.pattens.tech">
    <meta property="twitter:title" content="Verify Your Email Contact List | Email Validator">
    <meta property="twitter:description" content="Verify email addresses in your contact list instantly. Our email validator checks individual email addresses to ensure they are legitimate and deliverable.">
    <meta property="twitter:image" content="https://email-validator.pattens.tech/assets/twitter-card.jpg">
    <meta name="twitter:creator" content="@pattens-tech">
    <meta name="twitter:site" content="@pattens-tech">

    <!-- Additional SEO -->
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">

    <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="assets/pattens-logo.svg">
<link rel="icon" type="image/png" sizes="32x32" href="assets/pattens-logo.png">
<link rel="apple-touch-icon" href="assets/pattens-logo.png">

    <!-- CSS3 Stylesheet -->
    <link rel="stylesheet" href="styles.css">

    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>



    <!-- Schema.org Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Email Validator",
        "description": "Verify email addresses in your contact list instantly. Our email validator checks individual email addresses to ensure they are legitimate and deliverable.",
        "url": "https://email-validator.pattens.tech",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "creator": {
            "@type": "Organization",
            "name": "PATTENS",
            "url": "https://github.com/pattens-tech",
            "sameAs": [
                "https://x.com/pattens-tech",
                "https://github.com/pattens-tech"
            ]
        },
        "featureList": [
            "Bulk email verification",
            "CSV file upload",
            "Real-time validation",
            "Email deliverability check",
            "Contact list verification"
        ],
        "screenshot": "/assets/screenshot.jpg"
    }
    </script>

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://email-validator.pattens.tech/"
        }]
    }
    </script>

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "PATTENS",
        "url": "https://email-validator.pattens.tech",
        "logo": "https://pattens-tech.github.io/email-validator/assets/logo.png",
        "sameAs": [
            "https://x.com/pattens-tech",
            "https://github.com/pattens-tech"
        ],
        "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "Customer Support",
            "url": "https://github.com/pattens-tech"
        }
    }
    </script>
</head>
<body>
    <!-- Background Effects -->
    <div class="background-container">
        <!-- Gradient Animation Background -->
        <div class="gradient-background">
            <svg class="hidden">
                <defs>
                    <filter id="blurMe">
                        <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur"></feGaussianBlur>
                        <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -8" result="goo"></feColorMatrix>
                        <feBlend in="SourceGraphic" in2="goo"></feBlend>
                    </filter>
                </defs>
            </svg>
            <div class="gradients-container">
                <div class="gradient-orb gradient-orb-1"></div>
                <div class="gradient-orb gradient-orb-2"></div>
                <div class="gradient-orb gradient-orb-3"></div>
                <div class="gradient-orb gradient-orb-4"></div>
                <div class="gradient-orb gradient-orb-5"></div>
            </div>
        </div>

        <!-- Stars Background -->
        <div class="stars-container">
            <canvas id="starsCanvas" class="stars-canvas"></canvas>
        </div>

        <!-- Bottom Glow Effect -->
        <div class="bottom-glow-container">
            <svg class="bottom-glow-svg">
                <defs>
                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#2EB9DF;stop-opacity:0"></stop>
                        <stop offset="100%" style="stop-color:#9E00FF;stop-opacity:1"></stop>
                    </linearGradient>
                </defs>
            </svg>
            <div class="bottom-gradient"></div>
            <div class="bottom-glow-orb"></div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <a href="https://pattens.tech"><img src="assets/pattens-white.svg"  alt="Pattens Logo" width="200"></a>


            <a href="https://pattens.tech" class="header-logo-link">
                <div class="header-logo-placeholder">
                  
                </div>
            </a>
            <div class="header-actions">
              
                <a class="btn-github" href="https://github.com/pattens-tech">View on GitHub</a>
            </div>
        </header>

        <!-- Hero Section -->
        <div id="heroSection" class="hero-section">
            <section class="hero-content">
                <div class="hero-spacing">
                    <h1 class="hero-title">Contact list verification</h1>
                    <p class="hero-description">We'll verify your contact list to ensure all email addresses are legitimate.</p>
                    <div class="hero-actions">
                        <button id="verifyNowBtn" class="btn-verify">
                            Verify now
                            <span aria-hidden="true" class="btn-verify-arrow">→</span>
                        </button>
                    </div>
                    <p class="hero-terms">
                        By uploading your CSV, you agree to our <button class="terms-link open-modal">terms and privacy policy</button>.
                    </p>
                </div>
            </section>
        </div>

        <!-- Upload Section -->
        <div id="uploadSection" class="upload-section">
            <div class="upload-container">
                <!-- Initial Upload State -->
                <div id="uploadState" class="upload-state">
                    <div class="state-icon">
                        <img src="https://pattens-tech.github.io/email-validator/assets/upload-icon.png" alt="Upload" class="icon-img">
                    </div>
                    <div id="dropZone" class="drop-zone">
                        <p class="drop-zone-title">Upload now</p>
                        <p class="drop-zone-subtitle">Drag & Drop a CSV of emails only</p>
                        <input type="file" id="fileInput" accept=".csv" class="hidden">
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="hidden upload-state">
                    <div class="state-icon">
                        <div class="spinner"></div>
                    </div>
                    <div class="loading-content">
                        <p class="loading-text">
                            Validating <span id="emailCountDisplay">your emails</span>...
                        </p>
                        <div class="progress-bar-container">
                            <div id="progressBar" class="progress-bar"></div>
                        </div>
                    </div>
                </div>

                <!-- Success State -->
                <div id="successState" class="hidden upload-state">
                    <div class="state-icon">
                        <img src="https://pattens-tech.github.io/email-validator/assets/list.clipboard.png" alt="Success" class="icon-img">
                    </div>
                    <div class="success-content">
                        <!-- Summary View (default) -->
                        <div id="summaryView">
                            <div id="resultPercentage" class="result-percentage">87%</div>
                            <div class="result-label">Emails verified</div>
                            <div class="result-details">
                                <div class="result-row">
                                    <span>✓ Valid emails:</span>
                                    <span id="validCount" class="valid-count">0</span>
                                </div>
                                <div class="result-row">
                                    <span>✗ Invalid emails:</span>
                                    <span id="invalidCount" class="invalid-count">0</span>
                                </div>
                                <div class="result-row-total">
                                    <span>Total processed:</span>
                                    <span id="totalCount" class="total-count">0</span>
                                </div>
                            </div>
                            <div class="result-actions">
                                <button onclick="openPaymentModal()" class="btn-unlock">Unlock Full Report - £9.99</button>
                                <button onclick="resetForm()" class="btn-validate-another">Validate another file</button>
                            </div>
                        </div>

                        <!-- Detailed View (after payment) -->
                        <div id="detailedView" class="detailed-view">
                            <h3 class="detailed-title">Full Report</h3>
                            <p class="detailed-subtitle"><span id="detailedTotalCount">0</span> emails analyzed</p>
                            
                            <!-- Email list container -->
                            <div class="email-list-container">
                                <div id="emailList" class="email-list">
                                    <!-- Email items will be inserted here -->
                                </div>
                            </div>

                            <!-- Action buttons -->
                            <div class="result-actions">
                                <button onclick="downloadCSV()" class="btn-download">Download CSV</button>
                                <button onclick="resetForm()" class="btn-validate-another">Validate another file</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Error State -->
                <div id="errorState" class="hidden upload-state">
                    <div class="state-icon">
                        <div class="error-icon-container">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                        </div>
                    </div>
                    <div class="error-content">
                        <div id="errorMessage" class="error-message">Error, try again.</div>
                        <button onclick="resetForm()" class="btn-try-again">Try Again</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Terms & Privacy Modal -->
        <div id="termsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
            <div class="modal-overlay"></div>
            <div class="modal-container">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="modalTitle" class="modal-title">Terms & Privacy</h2>
                        <button id="closeModal" class="modal-close" aria-label="Close modal">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h3 class="modal-section-title">Terms & Conditions</h3>
                        <p class="modal-text">
                            
Effective Date: 29-10-2025
</p>
1. Introduction
</p>
Welcome to Pattens. By accessing or using this website, you agree to comply with and be bound by these Terms of Use.
If you do not agree, you must not use this site.
</p>
2. Use of the Service
</p>
Our service provides contact list verification, checking whether email addresses appear to be legitimate.
You agree to use the service only for lawful purposes and in a way that does not infringe the rights of others or restrict their use of the site.
</p>
3. Data Ownership and Responsibility
</p>
You must only upload or enter data that you own or have explicit permission to use.
You are fully responsible for ensuring that your use of the service complies with all applicable laws, including data protection and privacy regulations.
</p>
4. Accuracy and Limitations
</p>
We make reasonable efforts to ensure the service functions correctly, but we do not guarantee:
	•	that any email address verified is active, valid, or in use;
	•	that the service will be error-free or continuously available.
</p>
All use of the service is at your own risk.
</p>
5. Liability
</p>
Pattens accepts no liability for any loss, damage, or data issues resulting from the use or misuse of this website.
This includes, without limitation, indirect or consequential losses such as loss of data, business, or reputation.
</p>
6. Changes to Terms
</p>
We may update these Terms of Use at any time. The updated version will take effect immediately upon publication on this page.
</p>
7. Governing Law
</p>
These Terms are governed by and interpreted in accordance with the laws of England and Wales.
Any disputes will be subject to the exclusive jurisdiction of the courts of England and Wales.

</p>

                        <h3 class="modal-section-title modal-section-spacing">Privacy Policy</h3>


                        <p class="modal-text">
                            
Effective Date: 29-10-2025
</p>
1. Introduction
</p>
Pattens respects your privacy and is committed to protecting your personal data in accordance with the UK General Data Protection Regulation (UK GDPR) and the Data Protection Act 2018.
</p>
2. Data We Handle
</p>
Our service checks whether email addresses appear to be legitimate.
We do not store, sell, or share any email addresses or other uploaded data after verification is complete.
</p>
3. Cookies and Tracking
</p>
This website uses cookies for analytics and anonymized user experience improvement.
</p>
4. Third Parties
</p>
We do not share data with third parties, except where required by law or a valid legal request.
</p>
5. Your Data Rights
</p>
Under UK data protection law, you have the right to:
	•	request information about how your data is processed,
	•	request correction or deletion of any personal data (where applicable),
	•	lodge a complaint with the Information Commissioner’s Office (ICO) if you believe your data has been mishandled.
</p>
For any privacy-related queries, contact: hello@pattens.tech
</p>
6. Data Retention
</p>
No uploaded or verified data is stored beyond the duration of the verification process.
All other data is deleted immediately after the check is complete.
</p>
7. Policy Updates
</p>
We may occasionally update this Privacy Policy to reflect operational, legal, or regulatory changes.
Any updates will appear on this page with a revised effective date.

                        
                        </p>

                     
                        
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Modal -->
        <div id="paymentModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="paymentModalTitle">
            <div class="modal-overlay"></div>
            <div class="modal-container">
                <div class="modal-content payment-modal-content">
                    <div class="modal-header">
                        <h2 id="paymentModalTitle" class="modal-title">Unlock Full Report</h2>
                        <button id="closePaymentModal" class="modal-close" aria-label="Close payment modal">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p class="modal-text">Get access to the full detailed report with all email addresses and their validation status, plus CSV download.</p>
                        
                        <!-- Price display -->
                        <div class="payment-price">
                            <div class="payment-price-row">
                                <span class="payment-price-label">Full Report Access</span>
                                <span class="payment-price-value">£9.99</span>
                            </div>
                        </div>
                        
                        <!-- Loading state -->
                        <div id="paymentLoading" class="hidden payment-loading">
                            <div class="payment-loading-spinner"></div>
                            <p class="payment-loading-text">Preparing checkout...</p>
                        </div>
                        
                        <!-- Payment form -->
                        <form id="paymentForm" class="payment-form">
                            <!-- Payment Element container -->
                            <div id="paymentElement" class="payment-element-container"></div>
                            
                            <!-- Submit button -->
                            <button id="submitPayment" type="submit" class="btn-payment-submit">
                                <span id="buttonText">Pay £9.99</span>
                                <span id="buttonSpinner" class="hidden payment-button-spinner"></span>
                            </button>
                        </form>
                        
                        <!-- Error message -->
                        <div id="paymentError" class="hidden payment-error"></div>
                        
                        <!-- Success message -->
                        <div id="paymentSuccess" class="hidden payment-success">
                            <div class="payment-success-icon">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                            <h3 class="payment-success-title">Payment Successful!</h3>
                            <p class="payment-success-text">Your full report is now available.</p>
                            <button id="viewReportBtn" class="btn-view-report">
                                View Full Report
                            </button>
                        </div>
                        
                        <p class="payment-footer-text">Secure payment powered by Stripe</p>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="footer">
        <a href="https://pattens.tech" class="footer-link">
            Powered by 
            <span class="footer-underline">Pattens</span>
            : Built by AI
        </a>
    </footer>
    <!-- Stars Animation Script -->
    <script>
        const canvas = document.getElementById('starsCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        class Star {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2;
                this.speedX = (Math.random() - 0.5) * 0.5;
                this.speedY = (Math.random() - 0.5) * 0.5;
                this.opacity = Math.random();
                this.fadeSpeed = (Math.random() - 0.5) * 0.01;
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;

                if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
                if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;

                this.opacity += this.fadeSpeed;
                if (this.opacity <= 0 || this.opacity >= 1) this.fadeSpeed *= -1;
            }

            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        const stars = [];
        for (let i = 0; i < 150; i++) {
            stars.push(new Star());
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            stars.forEach(star => {
                star.update();
                star.draw();
            });
            requestAnimationFrame(animate);
        }

        animate();
    </script>

    <!-- Hero to Upload Transition Script -->
    <script>
        const heroSection = document.getElementById('heroSection');
        const uploadSection = document.getElementById('uploadSection');
        const verifyNowBtn = document.getElementById('verifyNowBtn');

        verifyNowBtn.addEventListener('click', () => {
            heroSection.classList.add('hiding');
            setTimeout(() => {
                heroSection.style.display = 'none';
                uploadSection.classList.add('visible');
            }, 500);
        });
    </script>

    <!-- File Upload Script -->
    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const uploadState = document.getElementById('uploadState');
        const loadingState = document.getElementById('loadingState');
        const successState = document.getElementById('successState');
        const errorState = document.getElementById('errorState');

        dropZone.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleFile(file);
        });

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file) handleFile(file);
        });

        async function handleFile(file) {
            if (!file.name.endsWith('.csv')) {
                showError('Please upload a valid CSV file');
                return;
            }

            uploadState.classList.add('hidden');
            loadingState.classList.remove('hidden');
            loadingState.classList.add('flex');

            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = '0%';
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 100 / 30;
                progressBar.style.width = Math.min(progress, 100) + '%';
                if (progress >= 100) clearInterval(progressInterval);
            }, 100);

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/api/validate-csv', {
                    method: 'POST',
                    body: formData
                });

                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('Non-JSON response:', text.substring(0, 200));
                    throw new Error('Server error. Please try again.');
                }

                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'Validation failed');

                showSuccess(data);
            } catch (error) {
                console.error('Error:', error);
                
                // Track errors with Vercel Analytics
                if (window.va) {
                    window.va('track', 'Validation Error', {
                        error: error.message || 'Unknown error'
                    });
                }
                
                showError(error.message || 'Error, try again.');
            }
        }

        function showSuccess(data) {
            loadingState.classList.add('hidden');
            loadingState.classList.remove('flex');
            successState.classList.remove('hidden');
            successState.classList.add('flex');
            
            // Update percentage
            document.getElementById('resultPercentage').textContent = Math.round(data.percentage) + '%';
            
            // Update detailed counts
            document.getElementById('validCount').textContent = data.valid || 0;
            document.getElementById('invalidCount').textContent = data.invalid || 0;
            document.getElementById('totalCount').textContent = data.total || 0;
            
            // Store email results in sessionStorage for payment flow
            if (data.emails && data.emails.length > 0) {
                sessionStorage.setItem('validationResults', JSON.stringify(data.emails));
            }
            
            // Track success with Vercel Analytics
            if (window.va) {
                window.va('track', 'Validation Success', {
                    total: data.total,
                    valid: data.valid,
                    invalid: data.invalid,
                    percentage: Math.round(data.percentage)
                });
            }
        }

        function showError(message) {
            uploadState.classList.add('hidden');
            loadingState.classList.add('hidden');
            loadingState.classList.remove('flex');
            errorState.classList.remove('hidden');
            errorState.classList.add('flex');
            document.getElementById('errorMessage').textContent = message;
        }

        function resetForm() {
            errorState.classList.add('hidden');
            errorState.classList.remove('flex');
            successState.classList.add('hidden');
            successState.classList.remove('flex');
            uploadState.classList.remove('hidden');
            fileInput.value = '';
            // Clear stored validation results
            sessionStorage.removeItem('validationResults');
        }

    </script>

    <!-- Payment Integration Script -->
    <script>
        // Initialize Stripe
        const stripe = Stripe('pk_test_51SNjUMCmTraQU9pzceHJC3Tx61bc1dUt6pfa3HiLsJgneB78gaPXmSX2Gq00YXf2NtuQFvCGsyP36jKqlWKvlPLl00tXTmiXPO');
        
        const paymentModal = document.getElementById('paymentModal');
        const closePaymentModalBtn = document.getElementById('closePaymentModal');
        const paymentLoading = document.getElementById('paymentLoading');
        const paymentError = document.getElementById('paymentError');
        const paymentForm = document.getElementById('paymentForm');
        const paymentSuccess = document.getElementById('paymentSuccess');
        const submitPaymentBtn = document.getElementById('submitPayment');
        const buttonText = document.getElementById('buttonText');
        const buttonSpinner = document.getElementById('buttonSpinner');
        const viewReportBtn = document.getElementById('viewReportBtn');

        let elements;
        let paymentElement;

        async function openPaymentModal() {
            // Get stored validation results
            const resultsJson = sessionStorage.getItem('validationResults');
            if (!resultsJson) {
                alert('No validation results found. Please validate emails first.');
                return;
            }

            let emails;
            try {
                emails = JSON.parse(resultsJson);
            } catch (e) {
                alert('Error loading validation results. Please try again.');
                return;
            }

            // Transform email data for payment API
            // The validation API returns detailed status codes, but the payment API expects 'Valid' or 'Invalid'
            const transformedEmails = emails.map(item => ({
                email: item.email,
                status: item.valid === true || item.status === 'Valid' ? 'Valid' : 'Invalid'
            }));

            // Show modal and loading state
            paymentModal.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
            paymentLoading.classList.remove('hidden');
            paymentError.classList.add('hidden');
            paymentForm.classList.add('hidden');
            paymentSuccess.classList.add('hidden');

            try {
                // Create payment intent
                const response = await fetch('/api/create-payment-intent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ emails: transformedEmails }),
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to create payment intent');
                }

                const { clientSecret } = await response.json();

                // Initialize Stripe Elements with custom styling
                const appearance = {
                    theme: 'night',
                    variables: {
                        colorPrimary: '#3b82f6',
                        colorBackground: '#0f172a',
                        colorText: '#e2e8f0',
                        colorDanger: '#ef4444',
                        fontFamily: 'system-ui, sans-serif',
                        spacingUnit: '4px',
                        borderRadius: '8px',
                    },
                    rules: {
                        '.Input': {
                            backgroundColor: 'rgba(255, 255, 255, 0.05)',
                            border: '1px solid rgba(255, 255, 255, 0.1)',
                            boxShadow: 'none',
                        },
                        '.Input:focus': {
                            border: '1px solid #3b82f6',
                            boxShadow: '0 0 0 1px #3b82f6',
                        },
                        '.Label': {
                            color: '#cbd5e1',
                            fontWeight: '500',
                        },
                    }
                };

                elements = stripe.elements({ clientSecret, appearance });
                paymentElement = elements.create('payment');
                paymentElement.mount('#paymentElement');

                // Hide loading and show form
                paymentLoading.classList.add('hidden');
                paymentForm.classList.remove('hidden');

            } catch (error) {
                console.error('Payment error:', error);
                paymentLoading.classList.add('hidden');
                paymentError.textContent = error.message || 'An error occurred. Please try again.';
                paymentError.classList.remove('hidden');

                // Track error with Vercel Analytics
                if (window.va) {
                    window.va('track', 'Payment Error', {
                        error: error.message || 'Unknown error'
                    });
                }
            }
        }

        async function handleSubmit(e) {
            e.preventDefault();

            if (!stripe || !elements) {
                return;
            }

            // Disable submit button
            submitPaymentBtn.disabled = true;
            buttonText.classList.add('hidden');
            buttonSpinner.classList.remove('hidden');
            paymentError.classList.add('hidden');

            try {
                const { error, paymentIntent } = await stripe.confirmPayment({
                    elements,
                    confirmParams: {
                        return_url: window.location.origin + '/?payment=success',
                    },
                    redirect: 'if_required',
                });

                if (error) {
                    // Payment failed
                    paymentError.textContent = error.message;
                    paymentError.classList.remove('hidden');

                    // Track error with Vercel Analytics
                    if (window.va) {
                        window.va('track', 'Payment Failed', {
                            error: error.message
                        });
                    }
                } else if (paymentIntent && paymentIntent.status === 'succeeded') {
                    // Payment succeeded
                    paymentForm.classList.add('hidden');
                    paymentSuccess.classList.remove('hidden');

                    // Track success with Vercel Analytics
                    if (window.va) {
                        window.va('track', 'Payment Success', {
                            amount: 9.99
                        });
                    }
                }
            } catch (err) {
                console.error('Payment error:', err);
                paymentError.textContent = 'An unexpected error occurred. Please try again.';
                paymentError.classList.remove('hidden');
            } finally {
                // Re-enable submit button
                submitPaymentBtn.disabled = false;
                buttonText.classList.remove('hidden');
                buttonSpinner.classList.add('hidden');
            }
        }

        paymentForm.addEventListener('submit', handleSubmit);

        viewReportBtn.addEventListener('click', () => {
            closePaymentModal();
            // Trigger showing detailed results
            showDetailedReport(JSON.parse(sessionStorage.getItem('validationResults')));
        });

        function closePaymentModal() {
            paymentModal.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
            paymentError.classList.add('hidden');
            paymentForm.classList.add('hidden');
            paymentSuccess.classList.add('hidden');
            
            // Clean up Stripe elements
            if (paymentElement) {
                paymentElement.unmount();
                paymentElement = null;
            }
            if (elements) {
                elements = null;
            }
        }

        closePaymentModalBtn.addEventListener('click', closePaymentModal);

        // Close modal on overlay click
        paymentModal.querySelector('.modal-overlay').addEventListener('click', closePaymentModal);

        // Prevent modal content clicks from closing modal
        paymentModal.querySelector('.modal-content').addEventListener('click', (e) => e.stopPropagation());

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !paymentModal.classList.contains('hidden')) {
                closePaymentModal();
            }
        });

        // Function to show detailed report
        function showDetailedReport(emails) {
            if (!emails || !Array.isArray(emails) || emails.length === 0) {
                console.error('No emails to display');
                return;
            }

            // Hide summary view, show detailed view
            document.getElementById('summaryView').classList.add('hidden');
            document.getElementById('detailedView').classList.remove('hidden');

            // Update total count
            document.getElementById('detailedTotalCount').textContent = emails.length;

            // Populate email list
            const emailList = document.getElementById('emailList');
            emailList.innerHTML = '';

            emails.forEach(item => {
                const row = document.createElement('div');
                row.className = 'email-item';
                
                const emailSpan = document.createElement('span');
                emailSpan.className = 'email-text';
                emailSpan.textContent = item.email;
                emailSpan.title = item.email; // Show full email on hover
                
                const badge = document.createElement('span');
                // Use the valid boolean field to determine display status
                const isValid = item.valid === true || item.status === 'Valid';
                badge.className = isValid ? 'status-badge status-badge-valid' : 'status-badge status-badge-invalid';
                badge.textContent = isValid ? 'Valid' : 'Invalid';
                
                row.appendChild(emailSpan);
                row.appendChild(badge);
                emailList.appendChild(row);
            });

            // Show success state if not already visible
            uploadState.classList.add('hidden');
            loadingState.classList.add('hidden');
            loadingState.classList.remove('flex');
            errorState.classList.add('hidden');
            errorState.classList.remove('flex');
            successState.classList.remove('hidden');
            successState.classList.add('flex');

            // Track with Vercel Analytics
            if (window.va) {
                window.va('track', 'Full Report Unlocked', {
                    emailCount: emails.length
                });
            }
        }

        // Check for session_id parameter on page load (payment success)
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session_id');

            if (sessionId) {
                // Payment was successful, get stored results
                const resultsJson = sessionStorage.getItem('validationResults');
                
                if (resultsJson) {
                    try {
                        const emails = JSON.parse(resultsJson);
                        showDetailedReport(emails);
                        
                        // Clean up URL (remove session_id parameter)
                        window.history.replaceState({}, document.title, window.location.pathname);
                    } catch (e) {
                        console.error('Error loading validation results:', e);
                    }
                } else {
                    console.log('Payment successful but no validation results found');
                }
            }
        });

        // Function to download CSV
        function downloadCSV() {
            const resultsJson = sessionStorage.getItem('validationResults');
            
            if (!resultsJson) {
                alert('No validation results found');
                return;
            }

            try {
                const emails = JSON.parse(resultsJson);
                
                if (!Array.isArray(emails) || emails.length === 0) {
                    alert('No emails to export');
                    return;
                }

                // Helper function to escape CSV fields
                function escapeCSVField(field) {
                    if (field == null) return '';
                    
                    const str = String(field);
                    
                    // If field contains comma, quote, or newline, wrap in quotes and escape quotes
                    if (str.includes(',') || str.includes('"') || str.includes('\n') || str.includes('\r')) {
                        return '"' + str.replace(/"/g, '""') + '"';
                    }
                    
                    return str;
                }

                // Build CSV content
                let csvContent = 'Email,Status\n';
                
                emails.forEach(item => {
                    const email = escapeCSVField(item.email);
                    const status = escapeCSVField(item.status);
                    csvContent += `${email},${status}\n`;
                });

                // Create blob and download
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                
                // Generate filename with timestamp
                const timestamp = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
                const filename = `email-report-${timestamp}.csv`;
                
                // Create download link
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Clean up object URL
                URL.revokeObjectURL(url);

                // Track with Vercel Analytics
                if (window.va) {
                    window.va('track', 'CSV Downloaded', {
                        emailCount: emails.length
                    });
                }
            } catch (e) {
                console.error('Error downloading CSV:', e);
                alert('Error downloading CSV. Please try again.');
            }
        }
    </script>

    <!-- Modal Script -->
    <script>
        const modal = document.getElementById('termsModal');
        const openModalBtns = document.querySelectorAll('.open-modal');
        const closeModalBtn = document.getElementById('closeModal');
        const modalOverlay = document.querySelector('.modal-overlay');

        let previousActiveElement;

        function openModal() {
            previousActiveElement = document.activeElement;
            modal.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
            setTimeout(() => closeModalBtn.focus(), 100);
        }

        function closeModal() {
            modal.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
            if (previousActiveElement) previousActiveElement.focus();
        }

        openModalBtns.forEach(btn => btn.addEventListener('click', openModal));
        closeModalBtn.addEventListener('click', closeModal);
        modalOverlay.addEventListener('click', closeModal);

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !modal.classList.contains('hidden')) closeModal();
        });

        modal.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];

                if (e.shiftKey && document.activeElement === firstElement) {
                    e.preventDefault();
                    lastElement.focus();
                } else if (!e.shiftKey && document.activeElement === lastElement) {
                    e.preventDefault();
                    firstElement.focus();
                }
            }
        });

        document.querySelector('.modal-content').addEventListener('click', (e) => e.stopPropagation());
    </script>

    <!-- Vercel Analytics -->
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
  
</body>

</html>
